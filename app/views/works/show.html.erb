<div style="margin:20px 60px;">
    <h1><%= @work.w_name %> のスケジュール</h1>
    <hr>
    <div class="row">
        <div class="col-sm-7">
            <h4><i class="fas fa-angle-double-right"></i>今週終わらせること</h4>
            <br>
            <div class="list-group">
                <a href="/tasks/<%= @recent_task_top.id %>" style="color:white;">
                    <div class="list-group-item list-group-item-action active">
                        <%= @recent_task_top.t_name %>　　
                        <small><i class="fas fa-clock"></i>　<%= @recent_task_top.start_date %>まで</small>
                    </div>
                </a>
                <% @recent_tasks.each do |r_task| %>
                    <a href="/tasks/<%= r_task.id %>" class="list-group-item list-group-item-action">
                        <%= r_task.t_name %>
                        <br>
                        <small>
                        <i class="fas fa-user-circle"></i>　<%= r_task.role %>
                        <br>
                        <i class="fas fa-clock"></i>　<%= r_task.end_date %>まで
                        </small>
                        <span class="btn btn-<%= r_task.task_status[1] %>" style="color:white;float:right;"><%= r_task.task_status[0] %></span>
                    </a>
                <% end %>
            </div>
        </div>
        <div class="col-sm-5">
            <h3><i class="fas fa-angle-double-right"></i><%= @work.w_name %>の進捗</h3>
            <br>
            <div class="progress">
                <div class="progress-bar" role="progressbar" aria-valuenow="5" aria-valuemin="0" aria-valuemax="100" style="width:25%;"></div>
                <span class="ml-1">5%</span>
            </div>
            <br>
            <hr>
            <h3><i class="fas fa-angle-double-right"></i>遅れそうなスケジュール</h3>
            <br>
            <div class="list-group">
                <% @late_tasks.each do |l_task| %>
                    <a href="/tasks/<%= l_task.id %>" class="list-group-item list-group-item-action">
                    <%= l_task.t_name %> <small>締め切り <%= (l_task.end_date - Date.today).to_i %>日前</small>
                    <span class="btn btn-<%= l_task.task_status[1] %>" style="color:white;float:right;"><%= l_task.task_status[0] %></span>
                    </a>
                <% end %>
            </div>
            <br>
            <hr>
            <h3><i class="fas fa-angle-double-right"></i>役割</h3>
            <br>
            <div class="list-group">
            <% @work.tasks.select(:role).distinct.each do |t_role| %>
                <div class="list-group-item list-group-item-action">
                    <i class="fas fa-user-circle"></i>　<%= t_role.role %><br>
                    <input type="text" class="form-control" style="width:120px;display:inline-block;" placeholder="名前を入力">
                    <input type="submit" class="btn btn-xs btn-success" value="送信する" style="display:inline-block;margin-left:10px;margin-bottom:5px;width:70px;padding-left:5px;">
                </div>
            <% end %>
            </div>
        </div>
    </div>
    <div class="" style="margin-top:40px;">
        <h4><i class="fas fa-angle-double-right"></i>内容</h4>
        <br>
        <p>まだ情報が少ないため、表示できません。</p>
        <br>
    </div>
    <div style="margin-top:40px;">
        <% w_start_date = @work.tasks.find_by(:t_number => 1, :parent_task_id => 0).start_date %>
        <% w_end_date = @work.tasks.find_by(:t_number => 1, :parent_task_id => 0).end_date %>
        <% w_diff_date = ((w_end_date - w_start_date+2).to_i/4).ceil %>
        <h4>一部カレンダー　<%= w_start_date %>〜<%= w_end_date %></h4>
        <br>
        <table class="table table-borderless">
            <thead>
            <tr style='font-size:12px;'>
                <td>タスク</td>
                <td><%= "#{w_start_date} 〜 #{w_start_date+w_diff_date}" %></td>
                <td><%= "#{w_start_date+w_diff_date+1} から #{w_start_date+w_diff_date*2}" %></td>
                <td><%= "#{w_start_date+w_diff_date*2+1} から #{w_start_date+w_diff_date*3}" %></td>
                <td><%= "#{w_start_date+w_diff_date*3+1} から #{w_end_date}" %></td>
            </tr>
            </thead>
            <% Task.where(:t_number => 1, :work_id => @work.id).where.not(:parent_task_id => 0).each do |w_task| %>
                <%= task_schedule_to_task_calendar(w_task, w_start_date, w_end_date, w_diff_date, true, false) %>
            <% end %>
        </table>
    </div>
    <br>
    <div>
        <h4><i class="fas fa-angle-double-right"></i>スケジュール</h4>
        <br>
        <table class="table">
            <% @persons.each do |person| %>
                <% p_tasks = person.tasks.pluck(:t_number).uniq %>
                <tr>
                    <td><%= person.p_name %>(<%= person.role %>)</td>
                    <% alert_array = ["danger", "primary", "warning", "success"]; %>
                    <% (1..4).each do |p_num| %>
                        <td>
                        <% if p_tasks.include?(p_num) %>
                            <div class="alert-<%= alert_array[p_num-1] %> text-center">
                                <a href="/tasks/<%= Task.find_by(:work_id => @work.id, :parent_task_id => 0, :t_number => p_num).id %>">
                                    <%= Task.find_by(:work_id => @work.id, :parent_task_id => 0, :t_number => p_num).t_name %>
                                    <br>
                                    <small><%= Task.find_by(:work_id => @work.id, :parent_task_id => 0, :t_number => p_num).end_date %>まで</small>
                                </a>
                            </div>
                        <% end %>
                        </td>
                    <% end %>
                </tr>
            <% end %>
        </table>
        <br>
        <h4><i class="fas fa-angle-double-right"></i>全タスク表</h4>
        <br>
        <div class="row">
        <% @tasks.each do |z_task| %>
            <% if z_task.parent_task_id == 0 %>
                <% if z_task.t_number != 1 %>
                    </div>
                <% end %>
                <div class="col-sm-6" style="margin-bottom:20px;">
                <div class="list-group">
                    <a href="/tasks/<%= z_task.id %>" class="list-group-item list-group-item-action active">
            <% else %>
                <a href="/tasks/<%= z_task.id %>" class="list-group-item list-group-item-action">
            <% end %>
                <%= z_task.t_name %>
                <br>
                <small>
                <i class="fas fa-user-circle"></i>　<%= z_task.role %>
                <br>
                <i class="fas fa-clock"></i>　<%= z_task.end_date %>まで
                </small>
                <br>
                <% if z_task.parent_task_id != 0 then %>
                <p><span class="btn btn-<%= z_task.task_status[1] %>" style="color:white;margin-top:-20px;float:right;"><%= z_task.task_status[0] %></span></p>
                <% end %>
            </a>
            <% if z_task.parent_task_id == 0 %>
                </div>
            <% end %>
        <% end %>
        </div>
    </div>
    <br>
</div>